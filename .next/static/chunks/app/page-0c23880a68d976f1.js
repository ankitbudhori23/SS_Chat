(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{419:(e,t,a)=>{"use strict";a.d(t,{n:()=>c});let c=e=>e?e.charAt(0).toUpperCase()+e.slice(1):""},723:e=>{e.exports={type_box:"typebox_type_box__VCXM9",type_box_util_upload:"typebox_type_box_util_upload__JAvKJ",show:"typebox_show__qjKjd",upload_optn:"typebox_upload_optn__e9YlI",upload_optn_dis:"typebox_upload_optn_dis__AEB45",file_preview:"typebox_file_preview__wAeNZ",file_preview_video:"typebox_file_preview_video__tXjGM",file_preview_document:"typebox_file_preview_document__CiO8h",file_preview_btn:"typebox_file_preview_btn__xwHOv",image_preview_btn:"typebox_image_preview_btn__po3Qq",image_preview_container:"typebox_image_preview_container__trxGs",image_preview_item:"typebox_image_preview_item__MGbCm",type_box_util:"typebox_type_box_util__UYZZY",type_box_send:"typebox_type_box_send__VjJ25"}},1368:e=>{e.exports={chat_page:"chat_chat_page__C9rYh",side_bar:"chat_side_bar__i89E4",side_bar_top:"chat_side_bar_top__LxLsv",side_bar_bottom:"chat_side_bar_bottom__11QBA",side_bar_icon_img:"chat_side_bar_icon_img__AjgVD",chat_img:"chat_chat_img__lFpoC",settings_img:"chat_settings_img__gkqCr",profile_img:"chat_profile_img__aXcsQ",divider:"chat_divider__sdBWi",chat_bar:"chat_chat_bar__Kr_w2",chat_bar_top:"chat_chat_bar_top__golLt",chat_bar_top_logo:"chat_chat_bar_top_logo__cYvwC",chat_bar_top_search_cn:"chat_chat_bar_top_search_cn__YacoV",search_icon:"chat_search_icon__8PlWm",chat_bar_top_search:"chat_chat_bar_top_search__o2Lcx",tags_list:"chat_tags_list__I7ROh",tag:"chat_tag__Uaq4i",tag_active:"chat_tag_active__TMZsT",chat_list:"chat_chat_list__50K1B",chatter_cn:"chat_chatter_cn__5Em6E",group_image:"chat_group_image__a2ibr",active_chatter:"chat_active_chatter__QO0ic",chatter_info:"chat_chatter_info__FQMYa",chatter_time:"chat_chatter_time__i1E9N",chatter_name:"chat_chatter_name__pJtvG",chatter_last_msg:"chat_chatter_last_msg__FNI_k",chatter_unread:"chat_chatter_unread__DLZlo",chat_bar_bottom:"chat_chat_bar_bottom__nn_iW",chatlist_toggle_btn:"chat_chatlist_toggle_btn__pjjrc",media_overlay:"chat_media_overlay__y2YEX",media_overlay_top:"chat_media_overlay_top___hDr5",media_overlay_close:"chat_media_overlay_close__XGaC7",media_overlay_main:"chat_media_overlay_main__OYevT",media_overlay_media:"chat_media_overlay_media__P8Nw6",media:"chat_media__E28VO",media_overlay_bottom:"chat_media_overlay_bottom__wA0MM",show_mobile:"chat_show_mobile__rM7x_"}},2804:(e,t,a)=>{"use strict";a.d(t,{p:()=>r});var c={cm:!0,mm:!0,in:!0,px:!0,pt:!0,pc:!0,em:!0,ex:!0,ch:!0,rem:!0,vw:!0,vh:!0,vmin:!0,vmax:!0,"%":!0};function r(e){var t=function(e){if("number"==typeof e)return{value:e,unit:"px"};var t,a=(e.match(/^[0-9.]*/)||"").toString();t=a.includes(".")?parseFloat(a):parseInt(a,10);var r=(e.match(/[^0-9]*$/)||"").toString();return c[r]?{value:t,unit:r}:(console.warn("React Spinners: ".concat(e," is not a valid css value. Defaulting to ").concat(t,"px.")),{value:t,unit:"px"})}(e);return"".concat(t.value).concat(t.unit)}},2972:(e,t,a)=>{"use strict";a.d(t,{NM:()=>r,Nv:()=>n,jT:()=>i,rG:()=>c});let c=(0,a(1990).Z0)({name:"chatList",initialState:{value:[]},reducers:{setChatList:(e,t)=>{let a=t.payload,c=Object.fromEntries(e.value.map(e=>[e.chat_group_id,e]));e.value=a.map(e=>{var t,a;let r=c[e.chat_group_id];return{...e,client_unread:null!=(a=null!=(t=null==r?void 0:r.client_unread)?t:e.unread_count)?a:0}})},unsetChatList:e=>{e.value=[]},incrementUnread:(e,t)=>{e.value=e.value.map(e=>e.chat_group_id===t.payload?{...e,client_unread:(e.client_unread||0)+1}:e)},resetUnread:(e,t)=>{e.value=e.value.map(e=>e.chat_group_id===t.payload?{...e,client_unread:0}:e)}}}),{setChatList:r,unsetChatList:s,incrementUnread:i,resetUnread:n}=c.actions},4747:(e,t,a)=>{"use strict";a.d(t,{A:()=>l});var c=a(2115),r=a(2804),s=a(8740),i=function(){return(i=Object.assign||function(e){for(var t,a=1,c=arguments.length;a<c;a++)for(var r in t=arguments[a])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},n=function(e,t){var a={};for(var c in e)Object.prototype.hasOwnProperty.call(e,c)&&0>t.indexOf(c)&&(a[c]=e[c]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,c=Object.getOwnPropertySymbols(e);r<c.length;r++)0>t.indexOf(c[r])&&Object.prototype.propertyIsEnumerable.call(e,c[r])&&(a[c[r]]=e[c[r]]);return a},o=(0,s.J)("BounceLoader","0% {transform: scale(0)} 50% {transform: scale(1.0)} 100% {transform: scale(0)}","bounce");let l=function(e){var t=e.loading,a=e.color,s=void 0===a?"#000000":a,l=e.speedMultiplier,_=void 0===l?1:l,d=e.cssOverride,u=e.size,m=void 0===u?60:u,h=n(e,["loading","color","speedMultiplier","cssOverride","size"]),p=function(e){return{position:"absolute",height:(0,r.p)(m),width:(0,r.p)(m),backgroundColor:s,borderRadius:"100%",opacity:.6,top:0,left:0,animationFillMode:"both",animation:"".concat(o," ").concat(2.1/_,"s ").concat(1===e?"".concat(1/_,"s"):"0s"," infinite ease-in-out")}},g=i({display:"inherit",position:"relative",width:(0,r.p)(m),height:(0,r.p)(m)},void 0===d?{}:d);return void 0===t||t?c.createElement("span",i({style:g},h),c.createElement("span",{style:p(1)}),c.createElement("span",{style:p(2)})):null}},5695:(e,t,a)=>{"use strict";var c=a(8999);a.o(c,"useRouter")&&a.d(t,{useRouter:function(){return c.useRouter}}),a.o(c,"useSearchParams")&&a.d(t,{useSearchParams:function(){return c.useSearchParams}})},6326:(e,t,a)=>{"use strict";a.d(t,{X5:()=>r,gr:()=>s,y4:()=>c});let c=(0,a(1990).Z0)({name:"selectedChat",initialState:{value:null},reducers:{setChat:(e,t)=>{e.value=t.payload},unsetChat:e=>{e.value=null}}}),{setChat:r,unsetChat:s}=c.actions},6563:(e,t,a)=>{"use strict";a.d(t,{FB:()=>s,Fw:()=>c,IK:()=>n,tj:()=>r});let c=(0,a(1990).Z0)({name:"messages",initialState:{value:[]},reducers:{addMessage:(e,t)=>{e.value.push(t.payload)},setMessages:(e,t)=>{e.value=t.payload},unsetMessages:e=>{e.value=[]},addOlderMessages:(e,t)=>{let a=t.payload,c=new Set(e.value.map(e=>e.id));e.value=[...a.filter(e=>!c.has(e.id)),...e.value]}}}),{addMessage:r,setMessages:s,unsetMessages:i,addOlderMessages:n}=c.actions},8417:(e,t,a)=>{Promise.resolve().then(a.bind(a,9316))},8577:e=>{e.exports={chat_main:"chatbox_chat_main__C3rl2",curr_chat_main_cn:"chatbox_curr_chat_main_cn__LD_6s",curr_chat_head_cn:"chatbox_curr_chat_head_cn__5_Q7a",curr_chat_head:"chatbox_curr_chat_head__GegQ0",curr_chat_img:"chatbox_curr_chat_img__6Evio",curr_chat_name:"chatbox_curr_chat_name__AYDad",curr_chat_status:"chatbox_curr_chat_status__d04U1",curr_chat_main:"chatbox_curr_chat_main___sd0_",message:"chatbox_message__6kVSv",sender_name:"chatbox_sender_name__G8OEv",curruser:"chatbox_curruser__cBbzp",message_media_cn:"chatbox_message_media_cn__VMFXS",message_media:"chatbox_message_media__c_cp7",message_text:"chatbox_message_text__5y0fs",message_time:"chatbox_message_time__7j1nn",chat_main_placeholder:"chatbox_chat_main_placeholder__5BMPr",date_divider:"chatbox_date_divider__OGYoN",new_messages_divider:"chatbox_new_messages_divider__9Db7Y",modal_overlay:"chatbox_modal_overlay__V2_Li",modal:"chatbox_modal__QRV85",modal_show:"chatbox_modal_show__Hpb30",modal_close:"chatbox_modal_close__Nridy",modal_head:"chatbox_modal_head__GvBt2",modal_name:"chatbox_modal_name__Eb3VY",modal_status:"chatbox_modal_status__TZ7s_",modal_img:"chatbox_modal_img__A4M4h",members:"chatbox_members__rVZrl"}},8740:(e,t,a)=>{"use strict";a.d(t,{J:()=>c});var c=function(e,t,a){var c="react-spinners-".concat(e,"-").concat(a);if("undefined"==typeof window||!window.document)return c;var r=document.createElement("style");document.head.appendChild(r);var s=r.sheet,i="\n    @keyframes ".concat(c," {\n      ").concat(t,"\n    }\n  ");return s&&s.insertRule(i,0),c}},9316:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>L});var c=a(5155),r=a(2115),s=a(1368),i=a.n(s),n=a(8577),o=a.n(n),l=a(723),_=a.n(l);let d=async(e,t)=>{let a="";a="document"===t?"uploadDoc":"video"===t?"uploadVideo":"uploadImage";let c=await fetch("https://studifysuccess.com/app/api/".concat(a),{method:"POST",body:e});return await c.json()};var u=a(4540),m=a(2972),h=a(4747);function p(e){let{topicRef:t,clientRef:a,groupMembers:s}=e,i=(0,u.wA)(),n=(0,u.d4)(e=>e.user.value),o=null==n?void 0:n.user_id,l=(0,u.d4)(e=>e.selectedChat.value),[p,g]=(0,r.useState)(""),[v,f]=(0,r.useState)(!1),x=(0,r.useRef)(null),[y,b]=(0,r.useState)(null),[j,w]=(0,r.useState)(null),[N,S]=(0,r.useState)(!1),[E,O]=(0,r.useState)([]),[C,k]=(0,r.useState)([]),M=(e,t)=>{if(f(!1),"image"!==t){let a=e.target.files[0];b({file:a,type:t,url:"image"===t||"video"===t?URL.createObjectURL(a):null})}else{let a=Array.from(e.target.files).map(e=>({file:e,type:t,url:URL.createObjectURL(e)}));O(e=>[...e,...a])}e.target.value=""};(0,r.useEffect)(()=>{let e=e=>{"INPUT"!==e.target.tagName&&"file"!==e.target.type&&x.current&&!x.current.contains(e.target)&&f(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]);let D=(0,r.useCallback)(()=>{var e,c;if(!t.current||!a.current||!l||!o)return;if(y&&!j&&N||E.length>0&&(!C||0===C.length)&&N)return void alert("Please wait for all files to finish uploading...");let r={};r=C.length>0?{chat_group_id:l.chat_group_id,receiver_id:null!=(e=l.receiver_id)?e:l.chat_group_id,message:p.trim()||" ",message_type:"image",sender_id:Number(o),media_url:JSON.stringify(C),created_at:new Date().toISOString()}:{chat_group_id:l.chat_group_id,receiver_id:null!=(c=l.receiver_id)?c:l.chat_group_id,message:p.trim()||" ",message_type:j?y.type:"text",sender_id:Number(o),media_url:(null==j?void 0:j.url)||null,created_at:new Date().toISOString()},(p.trim()||j||0!==C.length)&&(a.current.publish(t.current,JSON.stringify(r)),l.is_group?null==s||s.forEach(e=>{e.user_id!==o&&a.current.publish("notification/".concat(e.user_id),JSON.stringify({chat_group_id:"".concat(l.chat_group_id),receiver_id:"".concat(e.user_id),message:p.trim()||" ",data:{chat_group_id:"".concat(l.chat_group_id),display_name:"".concat(null==l?void 0:l.display_name)||"New message",is_group:"1",receiver_id:"".concat(e.user_id),screen:"Chat"}}))}):a.current.publish("notification/".concat(l.receiver_id),JSON.stringify({chat_group_id:"".concat(l.chat_group_id),receiver_id:"".concat(l.receiver_id),message:p.trim()||" ",data:{chat_group_id:"".concat(l.chat_group_id),display_name:"".concat(n.fname," ").concat(n.lname)||"New message",is_group:"0",receiver_id:"".concat(l.receiver_id),screen:"Chat"}})),g(""),b(null),w(null),O([]),k([]),i((0,m.Nv)(r.chat_group_id)))},[t,a,l,o,y,j,N,E,C,p,n,s,i]);return(0,r.useEffect)(()=>{let e=async()=>{S(!0);let e=new FormData;try{if(y){e.append(y.type,y.file);let t=await d(e,y.type);w(t)}if(E.length>0){let e=new FormData;E.forEach(t=>{e.append("images[]",t.file)});let t=await d(e,"image");k(t.urls)}}catch(e){console.error("Upload failed:",e)}finally{S(!1)}};(y||E.length>0)&&e()},[y,E]),(0,r.useEffect)(()=>{if(N||!l)return;let e=!!(y&&j),t=E.length>0&&C.length>0;(e||t)&&D()},[N,l,y,j,E,C,D]),(0,r.useEffect)(()=>{let e=e=>{x.current&&x.current.contains(e.target)||f(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),(0,c.jsxs)("div",{className:_().type_box,ref:x,children:[(0,c.jsxs)("div",{className:"".concat(_().type_box_util_upload," ").concat(v?_().show:""),children:[(0,c.jsxs)("div",{className:"".concat(_().upload_optn," ").concat(v?_().show:""),children:[(0,c.jsxs)("div",{className:_().upload_optn_dis,children:[(0,c.jsx)("img",{src:"/document.png"}),(0,c.jsx)("p",{children:"Document"})]}),(0,c.jsx)("input",{type:"file",accept:".pdf,.doc,.docx,.xls,.xlsx,.txt",onChange:e=>M(e,"document")})]}),(0,c.jsxs)("div",{className:"".concat(_().upload_optn," ").concat(v?_().show:""),children:[(0,c.jsxs)("div",{className:_().upload_optn_dis,children:[(0,c.jsx)("img",{src:"/image.png"}),(0,c.jsx)("p",{children:"Image"})]}),(0,c.jsx)("input",{type:"file",accept:"image/*",onChange:e=>M(e,"image"),multiple:!0})]}),(0,c.jsxs)("div",{className:"".concat(_().upload_optn," ").concat(v?_().show:""),children:[(0,c.jsxs)("div",{className:_().upload_optn_dis,children:[(0,c.jsx)("img",{src:"/video.png"}),(0,c.jsx)("p",{children:"Video"})]}),(0,c.jsx)("input",{type:"file",accept:"video/*",onChange:e=>M(e,"video")})]})]}),y&&(0,c.jsxs)("div",{className:_().file_preview,children:["video"===y.type&&(0,c.jsx)("video",{src:y.url,className:_().file_preview_video,muted:!0}),"document"===y.type&&(0,c.jsx)("span",{className:_().file_preview_document,children:y.file.name.length>8?y.file.name.slice(0,8)+"...":y.file.name}),(0,c.jsx)("div",{className:_().file_preview_btn,children:j?(0,c.jsx)("button",{onClick:()=>{b(null),w(null)},children:"✖"}):(0,c.jsx)(h.A,{color:"#D3D3D3",size:16})})]}),E.length>0&&(0,c.jsx)("div",{className:_().image_preview_container,children:E.map((e,t)=>(0,c.jsxs)("div",{className:_().image_preview_item,children:[(0,c.jsx)("img",{src:e.url,className:_().image_preview}),(0,c.jsx)("div",{className:_().image_preview_btn,children:(0,c.jsx)("button",{onClick:()=>{O(e=>e.filter((e,a)=>a!==t)),k(e=>e.filter((e,a)=>a!==t))},children:"✖"})})]},t))}),(0,c.jsx)("button",{className:_().type_box_util,onClick:()=>f(e=>!e)}),(0,c.jsx)("textarea",{placeholder:"Type a message.",onInput:()=>{let e=x.current;e&&(e.style.height="auto",e.style.height=Math.min(e.scrollHeight,100)+"px")},onChange:e=>g(e.target.value),value:p,onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),D())}}),(0,c.jsx)("button",{className:_().type_box_send,onClick:D,children:(0,c.jsx)("img",{src:"/send-white.png"})})]})}var g=a(419),v=a(9769);function f(e){let{topicRef:t,clientRef:a,fetchOlderMessages:s,setShowMediaOverlay:i,setMediaURL:n,setMediaType:l}=e,_=(0,u.d4)(e=>e.messages.value),d=(0,u.d4)(e=>e.user.value),m=(0,u.d4)(e=>e.selectedChat.value),h=(0,r.useRef)(null),f=(0,r.useRef)(!1),x=null==m?void 0:m.display_name.split(" "),y=(0,u.d4)(e=>e.chatList.value).find(e=>e.chat_group_id===(null==m?void 0:m.chat_group_id)),b=(null==y?void 0:y.client_unread)||0,j=(null==_?void 0:_.length)-b,[w,N]=(0,r.useState)(!1),S=(e,t)=>{i(!0),n(e),l(t)},E=localStorage.getItem("accessToken")||sessionStorage.getItem("accessToken"),[O,C]=(0,r.useState)([]);(0,r.useEffect)(()=>{let e=async()=>{C(await (0,v.$)(E,m.chat_group_id))};(null==m?void 0:m.is_group)==1&&e()},[m]);let k=(0,r.useMemo)(()=>new Map(O.map(e=>[e.user_id,e.name])),[O]);return(0,r.useEffect)(()=>{N(!1)},[m]),(0,r.useEffect)(()=>{let e=h.current;if(!e)return;let t=async()=>{if(0==e.scrollTop&&!f.current){f.current=!0;let t=e.scrollHeight,a=e.scrollTop;await s(),requestAnimationFrame(()=>{let c=e.scrollHeight;e.scrollTop=c-t+a,f.current=!1})}};return e.addEventListener("scroll",t),()=>e.removeEventListener("scroll",t)},[s]),(0,r.useEffect)(()=>{h.current&&(f.current||(h.current.scrollTop=h.current.scrollHeight))},[_,null==m?void 0:m.chat_group_id]),(0,c.jsxs)("div",{className:o().chat_main,children:[m&&0!=Object.keys(m).length?(0,c.jsxs)("div",{className:o().curr_chat_main_cn,children:[(0,c.jsx)("div",{className:o().curr_chat_head_cn,children:(0,c.jsxs)("button",{className:o().curr_chat_head,onClick:()=>N(!0),children:[(0,c.jsx)("div",{className:o().curr_chat_img,children:(0,c.jsx)("img",{src:"".concat(m.is_group?"/group.png":"/profile-gray.png")})}),(0,c.jsxs)("div",{className:o().curr_chat_name,children:[(0,c.jsx)("h2",{children:"".concat((0,g.n)(x[0])," ").concat((0,g.n)(x[1]))}),(0,c.jsx)("div",{className:o().curr_chat_status,children:"".concat(m.is_group?"Group Description":"Bio")})]})]})}),(0,c.jsx)("div",{className:o().curr_chat_main,ref:h,children:_&&_.length>0&&_.map((e,t)=>{let a=_[t-1],s=0==t||new Date(e.created_at).toDateString()!==new Date(null==a?void 0:a.created_at).toDateString();return(0,c.jsxs)(r.Fragment,{children:[s&&(0,c.jsx)("div",{className:o().date_divider,children:(e=>{let t=new Date(e),a=new Date,c=Math.floor((new Date(a.getFullYear(),a.getMonth(),a.getDate())-new Date(t.getFullYear(),t.getMonth(),t.getDate()))/864e5);return 0===c?"Today":1===c?"Yesterday":c<7?t.toLocaleDateString("en-US",{weekday:"long"}):t.toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"})})(e.created_at)}),t===j&&b>0&&(0,c.jsx)("div",{className:o().new_messages_divider,children:"New Messages"}),(0,c.jsxs)("div",{className:"".concat(o().message," ").concat(e.sender_id===(null==d?void 0:d.user_id)?o().curruser:""),children:[1==m.is_group&&e.sender_id!==(null==d?void 0:d.user_id)&&(0,c.jsx)("div",{className:o().sender_name,children:k.get(null==e?void 0:e.sender_id)}),e.media_url&&(0,c.jsxs)(c.Fragment,{children:["image"===e.message_type&&(()=>{let t=[];try{let a=JSON.parse(e.media_url);t=Array.isArray(a)?a:[a]}catch(a){t=[e.media_url]}return t.map((t,a)=>(0,c.jsx)("button",{onClick:()=>S(t,e.message_type),className:o().message_media_cn,children:(0,c.jsx)("img",{src:t,alt:"image",className:"".concat(o().message_media," ").concat(e.receiver_id===m.receiver_id?o().curruser:"")})},a))})(),"video"===e.message_type&&(0,c.jsx)("button",{onClick:()=>S(e.media_url,e.message_type),className:o().message_media_cn,children:(0,c.jsx)("video",{src:e.media_url,controls:!0,className:"".concat(o().message_media," ").concat(e.receiver_id===m.receiver_id?o().curruser:"")})}),"document"===e.message_type&&(0,c.jsx)("button",{onClick:()=>S(e.media_url,e.message_type),className:"".concat(o().message_media," ").concat(e.receiver_id===m.receiver_id?o().curruser:""),children:e.media_url.split("/").pop()})]}),(e.message||e.media_url)&&(0,c.jsx)("div",{className:o().message_text,children:e.message||""}),(0,c.jsx)("div",{className:o().message_time,children:(e=>{let t=new Date(e),a=t.getHours().toString().padStart(2,"0"),c=t.getMinutes().toString().padStart(2,"0");return"".concat(a,":").concat(c)})(null==e?void 0:e.created_at)})]})]},"".concat(e.id,"-").concat(t))})}),(0,c.jsx)(p,{topicRef:t,clientRef:a,groupMembers:O})]}):(0,c.jsx)("div",{className:o().chat_main_placeholder,children:"Select a group to start Conversation"}),w&&m&&(0,c.jsx)("div",{className:o().modal_overlay,onClick:()=>{N(!1)},children:(0,c.jsxs)("div",{className:"".concat(o().modal," ").concat(w?o().modal_show:""),onClick:e=>{e.stopPropagation()},children:[(0,c.jsx)("button",{className:o().modal_close,onClick:()=>N(!1),children:"✕"}),(0,c.jsxs)("div",{className:o().modal_head,children:[(0,c.jsx)("div",{className:o().modal_img,children:(0,c.jsx)("img",{src:"".concat((null==m?void 0:m.is_group)?"/group.png":"/profile-gray.png")})}),(0,c.jsxs)("div",{className:o().modal_name,children:[(0,c.jsx)("h2",{children:"".concat((0,g.n)(x[0])," ").concat((0,g.n)(x[1]))}),(0,c.jsx)("div",{className:o().modal_status,children:"".concat(m.is_group?"Group Description":"Bio")})]})]}),1===m.is_group&&(0,c.jsxs)("div",{className:o().members,children:[(0,c.jsx)("h3",{children:"Participants"}),O.map((e,t)=>{let a=e.name===(0,g.n)(null==d?void 0:d.fname)+" "+(0,g.n)(null==d?void 0:d.lname);return(0,c.jsx)("p",{children:"".concat(e.name," ").concat(a?"(You)":"")},t)})]})]})})]})}var x=a(228);let y=async e=>{let t=await fetch("".concat("https://api.studifysuccess.com","/api/chat/groups"),{method:"GET",headers:{"x-auth-token":"".concat(e),Authorization:"Bearer ".concat(e)}});if(401===t.status)return console.error("Unauthorized (401)"),localStorage.removeItem("accessToken"),sessionStorage.removeItem("accessToken"),localStorage.removeItem("reduxState"),window.location.href="/auth/login",null;if(!t.ok)throw Error("API error: ".concat(res.status));return(await t.json()).data},b=async function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:30,c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=await fetch("".concat("https://api.studifysuccess.com","/api/chat/chats/").concat(t,"?limit=").concat(a,"&offset=").concat(c),{method:"GET",headers:{"x-auth-token":"".concat(e),Authorization:"Bearer ".concat(e)}});if(401===r.status)return console.error("Unauthorized (401)"),localStorage.removeItem("accessToken"),sessionStorage.removeItem("accessToken"),localStorage.removeItem("reduxState"),window.location.href="/auth/login",null;if(!r.ok)throw Error("API error: ".concat(r.status));return(await r.json()).data};var j=a(6563),w=a(6326);function N(){let[e,t]=(0,r.useState)(null);(0,r.useEffect)(()=>{t(localStorage.getItem("accessToken"))},[]);let a=(0,u.wA)(),s=(0,u.d4)(e=>e.user.value),n=null==s?void 0:s.user_id,o=(0,u.d4)(e=>e.chatList.value),l=(0,u.d4)(e=>e.selectedChat.value),_=(0,r.useRef)(null),d=(0,r.useRef)(null),h=(0,r.useRef)(null),[p,v]=(0,r.useState)(!1);(0,r.useEffect)(()=>{_.current=null==l?void 0:l.chat_group_id},[null==l?void 0:l.chat_group_id]);let[N,S]=(0,r.useState)(""),[E,O]=(0,r.useState)("all"),C=o.filter(e=>e.display_name.toLowerCase().includes(N.toLowerCase())),k="unread"===E?C.filter(e=>e.client_unread>0):C,[M,D]=(0,r.useState)(0),[L,I]=(0,r.useState)(!1),[T,A]=(0,r.useState)(!1),[P,R]=(0,r.useState)(null),[U,B]=(0,r.useState)(null);(0,r.useEffect)(()=>{e&&(async()=>{let t=await y(e);a((0,m.NM)(t))})()},[e]),(0,r.useEffect)(()=>{if(!n||!e||d.current)return;let t=x.A.connect("wss://api.studifysuccess.com",{clientId:String(n),reconnectPeriod:0});t.on("connect",()=>{console.log("MQTT Broker Connected Successfully."),t.subscribe("notification/".concat(n))});let c=(e,t)=>{let c=t.toString();if(e===h.current){let e;try{e=JSON.parse(c)}catch(t){e={message:c}}a((0,j.tj)(e))}if(e==="notification/".concat(n)){let e=JSON.parse(c);String(_.current)!==e.chat_group_id&&a((0,m.jT)(Number(e.chat_group_id)))}};return t.on("message",c),d.current=t,()=>{t.off("message",c),t.end()}},[n,e]),(0,r.useEffect)(()=>{if(!e)return;let t=async()=>{let t=await b(e,null==l?void 0:l.chat_group_id,30,0);a((0,j.FB)(t))};(null==l?void 0:l.chat_group_id)&&t()},[null==l?void 0:l.chat_group_id,e]);let F=async()=>{if(L)return;let t=M+30,c=await b(e,null==l?void 0:l.chat_group_id,30,t);c.length>0&&(a((0,j.IK)(c)),D(t)),0==c.length&&I(!0)};(0,r.useEffect)(()=>{a((0,w.gr)())},[]),(0,r.useEffect)(()=>{let e=e=>{T&&(e.preventDefault(),A(!1),B(null),R(null))};return window.addEventListener("popstate",e),()=>{window.removeEventListener("popstate",e)}},[T]),(0,r.useEffect)(()=>{let e=e=>{T&&"Escape"===e.key&&(e.preventDefault(),A(!1),B(null),R(null))};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[T]);let Y=k?k.map((e,t)=>{let r=e.display_name.split(" "),s=(null==l?void 0:l.chat_group_id)===e.chat_group_id;return(0,c.jsxs)("a",{className:"".concat(i().chatter_cn," ").concat(s?i().active_chatter:""),onClick:()=>(e=>{if(!e||!d.current)return;(null==l?void 0:l.chat_group_id)&&l.chat_group_id!==e.chat_group_id&&(a((0,m.Nv)(l.chat_group_id)),D(0),I(!1));let t=e.is_group?"chat/".concat(e.chat_group_id):"chat/".concat([n,e.receiver_id].sort().join("-"));h.current&&h.current!=t&&d.current.unsubscribe(h.current),d.current.subscribe(t),h.current=t,a((0,w.X5)(e)),v(!1)})(e),children:[(0,c.jsx)("img",{src:"".concat(e.is_group?"/group.png":"/profile-gray.png"),className:"".concat(i().chatter_img," ").concat(e.is_group?i().group_image:"")}),(0,c.jsxs)("div",{className:i().chatter_info,children:[(0,c.jsx)("div",{className:i().chatter_name,children:"".concat((0,g.n)(r[0])," ").concat((0,g.n)(r[1]))}),e.client_unread>0&&(0,c.jsx)("div",{className:i().chatter_unread,children:e.client_unread})]})]},t)}):null;return(0,c.jsxs)("div",{className:i().chat_page,children:[(0,c.jsx)("div",{className:i().side_bar,children:(0,c.jsx)("div",{className:i().side_bar_top,children:(0,c.jsx)("button",{className:i().chatlist_toggle_btn,onClick:()=>v(!p),children:"☰"})})}),(0,c.jsxs)("div",{className:"".concat(i().chat_bar," ").concat(p?i().show_mobile:""),children:[(0,c.jsxs)("div",{className:i().chat_bar_top,children:[(0,c.jsxs)("div",{className:i().chat_bar_top_logo,children:[(0,c.jsx)("img",{src:"/logo.png"}),(0,c.jsx)("h2",{children:"studifysuccess"})]}),(0,c.jsxs)("div",{className:i().chat_bar_top_search_cn,children:[(0,c.jsx)("img",{src:"/search-white.png",className:i().search_icon}),(0,c.jsx)("input",{className:i().chat_bar_top_search,placeholder:"Search or start a new chat.",onChange:e=>S(e.target.value),value:N})]}),(0,c.jsxs)("div",{className:i().tags_list,children:[(0,c.jsx)("button",{className:"".concat(i().tag," ").concat("all"===E?i().tag_active:""),onClick:()=>O("all"),children:"All"}),(0,c.jsx)("button",{className:"".concat(i().tag," ").concat("unread"===E?i().tag_active:""),onClick:()=>O("unread"),children:"Unread"})]})]}),(0,c.jsx)("div",{className:i().chat_list,children:Y})]}),(0,c.jsx)(f,{topicRef:h,clientRef:d,fetchOlderMessages:F,setShowMediaOverlay:A,setMediaURL:R,setMediaType:B}),T&&(0,c.jsxs)("div",{className:i().media_overlay,children:[(0,c.jsx)("div",{className:i().media_overlay_top,children:(0,c.jsx)("button",{className:i().media_overlay_close,onClick:()=>{A(!1),B(null),R(null)},children:"✕"})}),(0,c.jsx)("div",{className:i().media_overlay_main,children:(0,c.jsxs)("div",{className:i().media_overlay_media,children:["image"===U&&(0,c.jsx)("img",{src:P,className:i().media}),"video"===U&&(0,c.jsx)("video",{src:P,controls:!0,className:i().media}),"document"===U&&(0,c.jsx)("embed",{src:P,type:"application/json",height:"100%",width:"1200px",className:i().media})]})}),(0,c.jsx)("div",{className:i().media_overlay_bottom})]})]})}var S=a(5695),E=a(2804),O=a(8740),C=function(){return(C=Object.assign||function(e){for(var t,a=1,c=arguments.length;a<c;a++)for(var r in t=arguments[a])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},k=function(e,t){var a={};for(var c in e)Object.prototype.hasOwnProperty.call(e,c)&&0>t.indexOf(c)&&(a[c]=e[c]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,c=Object.getOwnPropertySymbols(e);r<c.length;r++)0>t.indexOf(c[r])&&Object.prototype.propertyIsEnumerable.call(e,c[r])&&(a[c[r]]=e[c[r]]);return a},M=(0,O.J)("PulseLoader","0% {transform: scale(1); opacity: 1} 45% {transform: scale(0.1); opacity: 0.7} 80% {transform: scale(1); opacity: 1}","pulse");let D=function(e){var t=e.loading,a=e.color,c=void 0===a?"#000000":a,s=e.speedMultiplier,i=void 0===s?1:s,n=e.cssOverride,o=e.size,l=void 0===o?15:o,_=e.margin,d=void 0===_?2:_,u=k(e,["loading","color","speedMultiplier","cssOverride","size","margin"]),m=C({display:"inherit"},void 0===n?{}:n),h=function(e){return{backgroundColor:c,width:(0,E.p)(l),height:(0,E.p)(l),margin:(0,E.p)(d),borderRadius:"100%",display:"inline-block",animation:"".concat(M," ").concat(.75/i,"s ").concat(.12*e/i,"s infinite cubic-bezier(0.2, 0.68, 0.18, 1.08)"),animationFillMode:"both"}};return void 0===t||t?r.createElement("span",C({style:m},u),r.createElement("span",{style:h(1)}),r.createElement("span",{style:h(2)}),r.createElement("span",{style:h(3)})):null};function L(){let e=(0,S.useRouter)(),t=localStorage.getItem("accessToken");return((0,r.useEffect)(()=>{if(!t){localStorage.clear(),e.replace("auth/login");return}},[]),t)?(0,c.jsx)(N,{}):(0,c.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",backgroundColor:"#1a1a1a"},children:(0,c.jsx)(D,{color:"#16aa7e",size:15})})}},9769:(e,t,a)=>{"use strict";a.d(t,{$:()=>c});let c=async(e,t)=>{try{let a=await fetch("".concat("https://api.studifysuccess.com","/api/chat/groups/members/").concat(t),{method:"GET",headers:{"x-auth-token":"".concat(e),Authorization:"Bearer ".concat(e)}});if(401===a.status)return console.error("Unauthorized (401)"),localStorage.removeItem("accessToken"),sessionStorage.removeItem("accessToken"),localStorage.removeItem("reduxState"),window.location.href="/auth/login",null;if(!a.ok)throw Error("API error: ".concat(a.status));return(await a.json()).data}catch(e){console.error(e)}}}},e=>{e.O(0,[637,349,540,990,441,964,358],()=>e(e.s=8417)),_N_E=e.O()}]);