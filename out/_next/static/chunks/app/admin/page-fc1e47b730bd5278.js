(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[698],{5322:e=>{e.exports={admin_page:"page_admin_page__Gv_uq",admin_info:"page_admin_info__71Lok",admin_utils:"page_admin_utils__gm_qR",groups_util:"page_groups_util__Sd7Of",group_list:"page_group_list__KlXzb",group:"page_group__TG2fX",group_top:"page_group_top__4Pow3",group_info:"page_group_info__zt_qd",group_members:"page_group_members__4YuAF",no_members_msg:"page_no_members_msg___VY6r",edit_btn:"page_edit_btn__j6EiT",group_util_btns:"page_group_util_btns__5pd67",group_util_btn:"page_group_util_btn__AJg3c",group_util_delete:"page_group_util_delete__cfHmG",group_util_create:"page_group_util_create__wGSW_",group_util_checkbox:"page_group_util_checkbox__oZ1vs",edit_modal_overlay:"page_edit_modal_overlay__cvPmA",edit_modal:"page_edit_modal__l1k2P",edit_modal_close:"page_edit_modal_close__W1WBw",edit_name:"page_edit_name__j_2yg",edit_util_change:"page_edit_util_change__3LMXR",edit_members:"page_edit_members__ZwAKx",member_item:"page_member_item__d7XMi",admin_tag:"page_admin_tag__RDGbK",edit_delete:"page_edit_delete___FpXf",edit_add:"page_edit_add__qmRII",edit_add_input:"page_edit_add_input__Tj6z9"}},5816:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>j});var s=a(5155),n=a(5695),r=a(2115),c=a(5322),i=a.n(c),o=a(3568),l=a(4540);let d=async e=>{try{let t=await fetch("".concat("https://api.studifysuccess.com","/api/chat/allGroups"),{method:"GET",headers:{"x-auth-token":"".concat(e),Authorization:"Bearer ".concat(e)}});return(await t.json()).data}catch(e){return console.log("Error fetching groups.\n"+e),[]}};var u=a(9769);let _=async(e,t)=>{try{if((await fetch("".concat("https://api.studifysuccess.com","/api/chat/groups"),{method:"POST",headers:{"Content-Type":"application/json","x-auth-token":"".concat(e),Authorization:"Bearer ".concat(e)},body:JSON.stringify({is_group:1,name:t})})).ok)return console.log("Group Created Successfully."),!0;return console.error("Failed to create new group."),!1}catch(e){return console.error("Error creating a new group : \n",e),!1}},m=async(e,t)=>{try{let a=t.map(async t=>{if(!(await fetch("".concat("https://api.studifysuccess.com","/api/chat/groups/").concat(t.id),{method:"PUT",headers:{"Content-Type":"application/json","x-auth-token":"".concat(e),Authorization:"Bearer ".concat(e)},body:JSON.stringify({name:t.name,is_deleted:1})})).ok)throw Error("Failed to delete group with id ".concat(t.id,"."));return t});return await Promise.all(a)}catch(e){return console.error("Error deleting groups : \n",e),[]}},p=async(e,t,a)=>{try{if((await fetch("".concat("https://api.studifysuccess.com","/api/chat/groups/").concat(t),{method:"PUT",headers:{"Content-Type":"application/json","x-auth-token":"".concat(e),Authorization:"Bearer ".concat(e)},body:JSON.stringify({name:a,is_deleted:0})})).ok)return console.log("Group Name Changed successfully"),!0;return console.log("Failed to change group name"),!1}catch(e){return console.log("Error changing the group name : \n",e),!1}},h=async(e,t,a)=>{try{let s=a.map(async a=>{if(!(await fetch("".concat("https://api.studifysuccess.com","/api/chat/groups/members/").concat(t),{method:"DELETE",headers:{"Content-Type":"application/json","x-auth-token":e,Authorization:"Bearer ".concat(e)},body:JSON.stringify({user_id:a})})).ok)throw Error("Failed to delete member with id ".concat(id,"."));return a});return await Promise.all(s)}catch(e){return console.error("Error delete members : \n",e),[]}},g=async(e,t,a)=>{try{if((await fetch("".concat("https://api.studifysuccess.com","/api/chat/groups/members/").concat(t),{method:"POST",headers:{"Content-Type":"application/json","x-auth-token":e,Authorization:"Bearer ".concat(e)},body:JSON.stringify(a)})).ok)return console.log("Member added successfully"),!0;return console.error("Failed to add member"),!1}catch(e){return console.error("Error adding user:\n",e),!1}};var x=a(4747);function j(){let e=(0,n.useRouter)();(0,l.wA)();let[t,a]=(0,r.useState)(null),[c,j]=(0,r.useState)(!0);(0,r.useEffect)(()=>{let t=localStorage.getItem("accessToken")||sessionStorage.getItem("accessToken");if(!t){localStorage.clear(),e.replace("auth/login");return}a(t),j(!1)},[e]),(0,l.d4)(e=>e.user.value);let[b,y]=(0,r.useState)([]),[f,v]=(0,r.useState)(null),[N,k]=(0,r.useState)(null),w=async e=>{v(await (0,u.$)(t,e)),k(N===e?null:e)},[C,S]=(0,r.useState)(!1),[E,A]=(0,r.useState)([]),T=async()=>{0!==E.length&&(await m(t,E)).length===E.length&&(o.Ay.success("Group".concat(1!==E.length?"s":""," deleted successfully.")),y(await d(t)),A([]),S(!1))},[G,z]=(0,r.useState)(!1),[P,O]=(0,r.useState)(null),[D,B]=(0,r.useState)(!1),[I,M]=(0,r.useState)(!1),[q,F]=(0,r.useState)(""),L=async()=>{q&&await p(t,N,q)&&(o.Ay.success("Group Name Changed Successfully."),y(await d(t)),O(e=>({...e,name:q})),F(""))},[J,R]=(0,r.useState)([]),X=async()=>{0!=J.length&&(await h(t,N,J)).length===J.length&&(o.Ay.success("Member".concat(1!==J.length?"s":""," removed from the group successfully.")),v(await await (0,u.$)(t,N)),R([]))},[$,U]=(0,r.useState)({user_id:"",role:""}),K=async()=>{if(!N||!$.user_id||!$.role)return;let e={...$,user_id:Number($.user_id)};await g(t,N,e)&&(o.Ay.success("New Member Added!"),v(await await (0,u.$)(t,N)),U({user_id:"",role:""}))},W=e=>{let{name:t,value:a}=e.target;U(e=>({...e,[t]:a}))},[Y,Z]=(0,r.useState)(""),H=async()=>{Y&&await _(t,Y)&&(o.Ay.success('Group "'.concat(Y,'" created successfully.')),y(await d(t)),V(),Z(""))};(0,r.useEffect)(()=>{(async()=>{t&&y(await d(t))})()},[t]);let V=()=>{M(!1),z(!1),O(null),v(null),k(null)};return((0,r.useEffect)(()=>{if(!G&&!I)return;let e=e=>{let t=document.querySelector(".".concat(i().edit_modal));t&&!t.contains(e.target)&&V()},t=e=>{"Escape"===e.key&&V()};return document.addEventListener("mousedown",e),document.addEventListener("keydown",t),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("keydown",t)}},[G]),c)?(0,s.jsx)("div",{className:i().logs_page,children:(0,s.jsx)(x.A,{color:"#D3D3D3",size:30})}):(0,s.jsxs)("div",{className:i().admin_page,children:[(0,s.jsx)(o.l$,{position:"bottom-right",reverseOrder:!1}),I&&(0,s.jsx)("div",{className:i().edit_modal_overlay,children:(0,s.jsxs)("div",{className:i().edit_modal,children:[(0,s.jsx)("button",{className:i().edit_modal_close,onClick:()=>V(),children:"✖"}),(0,s.jsx)("h2",{children:"Create a new group."}),(0,s.jsx)("h4",{children:"Enter group name"}),(0,s.jsxs)("div",{className:i().edit_name,children:[(0,s.jsx)("input",{type:"text",onChange:e=>Z(e.target.value),value:Y}),(0,s.jsxs)("button",{className:"".concat(i().group_util_btn," ").concat(i().edit_util_change),onClick:H,children:[(0,s.jsx)("img",{src:"./edit.png"}),(0,s.jsx)("p",{children:"Create"})]})]})]})}),G&&(0,s.jsx)("div",{className:i().edit_modal_overlay,children:(0,s.jsxs)("div",{className:i().edit_modal,children:[(0,s.jsx)("button",{className:i().edit_modal_close,onClick:()=>V(),children:"✖"}),(0,s.jsx)("h2",{children:P.name}),(0,s.jsx)("h4",{children:"Change Name"}),(0,s.jsxs)("div",{className:i().edit_name,children:[(0,s.jsx)("input",{type:"text",onChange:e=>F(e.target.value),value:q}),(0,s.jsxs)("button",{className:"".concat(i().group_util_btn," ").concat(i().edit_util_change),onClick:L,children:[(0,s.jsx)("img",{src:"./edit.png"}),(0,s.jsx)("p",{children:"Change"})]})]}),(0,s.jsx)("h4",{children:"Members"}),(0,s.jsxs)("div",{className:i().edit_members,children:[f&&0!==f.length?f.map((e,t)=>(0,s.jsxs)("div",{className:i().member_item,children:[D&&(0,s.jsx)("input",{type:"checkbox",className:i().group_util_checkbox,onClick:t=>{t.target.checked?R(t=>[...t,e.user_id]):R(t=>t.filter(t=>t!=e.user_id))}}),(0,s.jsxs)("p",{children:[e.name," ",(0,s.jsx)("span",{className:i().admin_tag,children:"user"!==e.role?"( Admin )":""})]})]},t)):(0,s.jsx)("div",{className:i().no_members_msg,children:(0,s.jsx)("p",{children:"This group doesn’t have any members yet."})}),(0,s.jsxs)("div",{className:i().edit_delete,children:[D&&(0,s.jsxs)("button",{className:"".concat(i().group_util_btn," ").concat(i().group_util_delete),onClick:()=>X(),children:[(0,s.jsx)("img",{src:"./delete.png"}),(0,s.jsx)("p",{children:"Confirm Delete"})]}),f&&0!==f.length&&(0,s.jsxs)("button",{className:"".concat(i().group_util_btn," ").concat(D?" ":i().group_util_delete),onClick:()=>{D&&R([]),B(e=>!e)},children:[!D&&(0,s.jsx)("img",{src:"./delete.png"}),(0,s.jsx)("p",{children:D?"Cancel":"Delete"})]})]})]}),(0,s.jsx)("h4",{children:"Add New Member"}),(0,s.jsxs)("div",{className:i().edit_add,children:[(0,s.jsxs)("div",{className:i().edit_add_input,children:[(0,s.jsx)("input",{type:"text",name:"user_id",value:$.user_id,onChange:W,required:!0}),(0,s.jsxs)("select",{name:"role",value:$.role,onChange:W,required:!0,children:[(0,s.jsx)("option",{value:"",disabled:!0,children:"Select Role"}),(0,s.jsx)("option",{value:"user",children:"User"}),(0,s.jsx)("option",{value:"admin",children:"Admin"})]})]}),(0,s.jsxs)("button",{className:"".concat(i().group_util_btn," ").concat(i().group_util_create),onClick:()=>K(),children:[(0,s.jsx)("img",{src:"./add.png"}),(0,s.jsx)("p",{children:"Add"})]})]})]})}),(0,s.jsx)("div",{className:i().admin_info,children:(0,s.jsx)("h2",{children:"Admin Panel"})}),(0,s.jsx)("div",{className:i().admin_utils,children:(0,s.jsxs)("div",{className:i().groups_util,children:[(0,s.jsx)("h2",{children:"Groups"}),(0,s.jsx)("div",{className:i().group_list,children:b.map((t,a)=>1===t.is_deleted?null:(0,s.jsxs)("div",{className:i().group,children:[(0,s.jsxs)("div",{className:i().group_top,children:[C&&(0,s.jsx)("input",{type:"checkbox",className:i().group_util_checkbox,onClick:e=>{e.target.checked?A(e=>[...e,t]):A(e=>e.filter(e=>e.id!==t.id))}}),(0,s.jsx)("button",{className:i().group_info,onClick:()=>w(t.id),children:t.name}),(0,s.jsx)("button",{className:i().edit_btn,onClick:()=>{z(!0),O(t),w(t.id)},children:(0,s.jsx)("img",{src:"./edit.png"})}),(0,s.jsx)("button",{className:i().edit_btn,onClick:()=>e.push("/admin/logs/".concat(null==t?void 0:t.id)),children:(0,s.jsx)("img",{src:"./chat-white.png"})})]}),!G&&t.id===N&&(0,s.jsxs)("div",{className:i().group_members,children:[(0,s.jsxs)("h4",{children:["Members ",(0,s.jsxs)("span",{children:["(",f.length,")"]})]}),f&&0!==f.length&&!G?f.map((e,t)=>(0,s.jsxs)("p",{children:[e.name," ",(0,s.jsx)("span",{className:i().admin_tag,children:"user"!==e.role?"( Admin )":""})]},t)):(0,s.jsxs)("div",{className:i().no_members_msg,children:[(0,s.jsx)("p",{children:"This group doesn’t have any members yet."}),(0,s.jsxs)("p",{children:["Click ",(0,s.jsx)("b",{children:"Edit"})," to add members."]})]})]})]},a))}),(0,s.jsxs)("div",{className:i().group_util_btns,children:[C&&(0,s.jsxs)("button",{className:"".concat(i().group_util_btn," ").concat(i().group_util_delete),onClick:T,children:[(0,s.jsx)("img",{src:"./delete.png"}),(0,s.jsx)("p",{children:"Confirm Delete"})]}),(0,s.jsxs)("button",{className:"".concat(i().group_util_btn," ").concat(C?" ":i().group_util_delete),onClick:()=>{C&&A([]),S(e=>!e)},children:[!C&&(0,s.jsx)("img",{src:"./delete.png"}),(0,s.jsx)("p",{children:C?"Cancel":"Delete"})]}),(0,s.jsxs)("button",{className:"".concat(i().group_util_btn," ").concat(i().group_util_create),onClick:()=>M(!0),children:[(0,s.jsx)("img",{src:"./create.png"}),(0,s.jsx)("p",{children:"Create"})]})]})]})})]})}},6047:(e,t,a)=>{Promise.resolve().then(a.bind(a,5816))},9769:(e,t,a)=>{"use strict";a.d(t,{$:()=>s});let s=async(e,t)=>{try{let a=await fetch("".concat("https://api.studifysuccess.com","/api/chat/groups/members/").concat(t),{method:"GET",headers:{"x-auth-token":"".concat(e),Authorization:"Bearer ".concat(e)}});if(401===a.status)return console.error("Unauthorized (401)"),localStorage.removeItem("accessToken"),sessionStorage.removeItem("accessToken"),localStorage.removeItem("reduxState"),window.location.href="/auth/login",null;if(!a.ok)throw Error("API error: ".concat(a.status));return(await a.json()).data}catch(e){console.error(e)}}}},e=>{e.O(0,[321,540,528,441,964,358],()=>e(e.s=6047)),_N_E=e.O()}]);